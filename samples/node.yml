# node.yml

mixins:
  node:
    provisions:

      - kind: shell
        name: node
        privileged: false
        inline: |
          config_environ() {
            echo 'export NVM_DIR="$HOME/.nvm"' >> ~/.bashrc
            echo '[ -s "$NVM_DIR/nvm.sh" ] && . "$NVM_DIR/nvm.sh"' >> ~/.bashrc
          }
          export NVM_DIR="$HOME/.nvm" && (
            git clone https://github.com/creationix/nvm.git "$NVM_DIR"
            cd "$NVM_DIR"
            git checkout `git describe --abbrev=0 --tags --match "v[0-9]*" origin`
          ) && . "$NVM_DIR/nvm.sh" && nvm install node && config_environ

      - kind: shell
        name: npm-custom
        privileged: false
        inline: |
          cat - <<'EOF'>> ~/.bashrc
            export PATH="$PATH:$(echo ~/vagrant_root/node_modules/*/bin | tr [:blank:] ':')"
            alias npm="npm --no-bin-links"
          EOF
